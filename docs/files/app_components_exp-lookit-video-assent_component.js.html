<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app/components/exp-lookit-video-assent/component.js - ember-lookit-frameplayer</title>
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="https://yui-s.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="https://yui-s.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">
<div id="doc">
    <div id="bd" class="yui3-g">
        <div class="yui3-u-1-5">
            <div id="docs-sidebar" class="sidebar apidocs">
              <h2 style="display:inline;">
              <div>
                <img style="float:right; vertical-align:middle;" src="../assets/css/logo.png" height="70">
                <span>Lookit<br> component<br> docs</span>
              </div>

              </h2>


              <div id="api-list">
                  <div id="api-tabview">
              
                    <div id="api-tabview-panel">
                        <h2 class="off-left">Collections</h2>
                        <ul id="api-modules" class="apis modules">
                            <li class="module-sidebar-components"><a href="../modules/components.html">components</a></li>
                            <li class="module-sidebar-exp-player"><a href="../modules/exp-player.html">exp-player</a></li>
                            <li class="module-sidebar-frames"><a href="../modules/frames.html">frames</a></li>
                            <li class="module-sidebar-mixins"><a href="../modules/mixins.html">mixins</a></li>
                            <li class="module-sidebar-randomizers"><a href="../modules/randomizers.html">randomizers</a></li>
                            <li class="module-sidebar-services"><a href="../modules/services.html">services</a></li>
                        </ul>
                        <h2 class="off-left">All elements</h2>
                              <div id="api-tabview-filter">
                      <input type="search" id="api-filter" placeholder="Type to filter">
                    </div>
                        <ul id="api-classes" class="apis classes">
                            <li><a href="../classes/ExpandAssets.html">ExpandAssets</a></li>
                            <li><a href="../classes/ExpExitSurvey.html">ExpExitSurvey</a></li>
                            <li><a href="../classes/ExpFrameBase.html">ExpFrameBase</a></li>
                            <li><a href="../classes/ExpFrameSelect.html">ExpFrameSelect</a></li>
                            <li><a href="../classes/ExpLookitDialoguePage.html">ExpLookitDialoguePage</a></li>
                            <li><a href="../classes/ExpLookitExitSurvey.html">ExpLookitExitSurvey</a></li>
                            <li><a href="../classes/ExpLookitGeometryAlternation.html">ExpLookitGeometryAlternation</a></li>
                            <li><a href="../classes/ExpLookitInstructions.html">ExpLookitInstructions</a></li>
                            <li><a href="../classes/ExpLookitMoodQuestionnaire.html">ExpLookitMoodQuestionnaire</a></li>
                            <li><a href="../classes/ExpLookitObservation.html">ExpLookitObservation</a></li>
                            <li><a href="../classes/ExpLookitPreferentialLooking.html">ExpLookitPreferentialLooking</a></li>
                            <li><a href="../classes/ExpLookitPreviewExplanation.html">ExpLookitPreviewExplanation</a></li>
                            <li><a href="../classes/ExpLookitStoryPage.html">ExpLookitStoryPage</a></li>
                            <li><a href="../classes/ExpLookitSurvey.html">ExpLookitSurvey</a></li>
                            <li><a href="../classes/ExpLookitText.html">ExpLookitText</a></li>
                            <li><a href="../classes/ExpLookitVideo.html">ExpLookitVideo</a></li>
                            <li><a href="../classes/ExpLookitVideoAssent.html">ExpLookitVideoAssent</a></li>
                            <li><a href="../classes/ExpLookitVideoConsent.html">ExpLookitVideoConsent</a></li>
                            <li><a href="../classes/ExpPlayer.html">ExpPlayer</a></li>
                            <li><a href="../classes/ExpVideoConfig.html">ExpVideoConfig</a></li>
                            <li><a href="../classes/ExpVideoConfigQuality.html">ExpVideoConfigQuality</a></li>
                            <li><a href="../classes/ExpVideoConsent.html">ExpVideoConsent</a></li>
                            <li><a href="../classes/ExpVideoPreview.html">ExpVideoPreview</a></li>
                            <li><a href="../classes/FullScreen.html">FullScreen</a></li>
                            <li><a href="../classes/MediaReload.html">MediaReload</a></li>
                            <li><a href="../classes/permute.html">permute</a></li>
                            <li><a href="../classes/RandomParameterSet.html">RandomParameterSet</a></li>
                            <li><a href="../classes/Select.html">Select</a></li>
                            <li><a href="../classes/videoRecorder.html">videoRecorder</a></li>
                            <li><a href="../classes/VideoRecorderObject.html">VideoRecorderObject</a></li>
                            <li><a href="../classes/VideoRecordMixin.html">VideoRecordMixin</a></li>
                        </ul>
                    </div>
              
                  </div>
              </div>
            </div>
        </div>
        <div class="yui3-u-4-5">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: app/components/exp-lookit-video-assent/component.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import Em from &#x27;ember&#x27;;
import layout from &#x27;./template&#x27;;

import ExpFrameBaseComponent from &#x27;../exp-frame-base/component&#x27;;
import MediaReload from &#x27;../../mixins/media-reload&#x27;;
import VideoRecord from &#x27;../../mixins/video-record&#x27;;
import ExpandAssets from &#x27;../../mixins/expand-assets&#x27;;
import { computed } from &#x27;@ember/object&#x27;;

let {
    $
} = Em;

/**
 * @module exp-player
 * @submodule frames
 */

/**
Video assent frame for Lookit studies for older children to agree to participation,
separately from parental consent.

A series of assent form &quot;pages&quot; is displayed, each one displaying an image, video,
the webcam view, and/or text. Once the family has viewed all pages, the child can
answer a question about whether to participate. If they choose yes, they proceed; if
they choose no, they are sent to the exit URL.

Specifying media locations:
For &#x60;imgSrc&#x60; parameters within &#x60;pages&#x60;, you can either specify complete URLs or partial URLs
relative to a base directory &#x60;baseDir&#x60; for the frame. Images are expected to be in an
&#x60;img&#x60; directory within the &#x60;baseDir&#x60;. For instance, in the example below,
the first page&#x27;s image is at &#x60;https://s3.amazonaws.com/lookitcontents/cats/img/jane_smith.jpg&#x60;.

For any parameters that expect a list of audio/video sources, you can EITHER provide
a list of src/type pairs with full paths like this:
&#x60;&#x60;&#x60;json
    [
        {
            &#x27;src&#x27;: &#x27;http://.../video1.mp4&#x27;,
            &#x27;type&#x27;: &#x27;video/mp4&#x27;
        },
        {
            &#x27;src&#x27;: &#x27;http://.../video1.webm&#x27;,
            &#x27;type&#x27;: &#x27;video/webm&#x27;
        }
    ]
&#x60;&#x60;&#x60;
OR you can provide a single string &#x27;stub&#x27;, which will be expanded
based on the parameter baseDir and the media types expected - either audioTypes or
videoTypes as appropriate. For example, if you provide the audio source &#x60;intro&#x60;
and baseDir is https://mystimuli.org/mystudy/, with audioTypes [&#x27;mp3&#x27;, &#x27;ogg&#x27;], then this
will be expanded to:
&#x60;&#x60;&#x60;json
                 [
                        {
                            src: &#x27;https://mystimuli.org/mystudy/mp3/intro.mp3&#x27;,
                            type: &#x27;audio/mp3&#x27;
                        },
                        {
                            src: &#x27;https://mystimuli.org/mystudy/ogg/intro.ogg&#x27;,
                            type: &#x27;audio/ogg&#x27;
                        }
                ]
&#x60;&#x60;&#x60;
This allows you to simplify your JSON document a bit and also easily switch to a
new version of your stimuli without changing every URL. You can mix source objects with
full URLs and those using stubs within the same directory. However, any stimuli
specified using stubs MUST be organized as expected under baseDir/MEDIATYPE/filename.MEDIATYPE.

&#x60;&#x60;&#x60;json
&quot;frames&quot;: {
    &quot;video-assent&quot;: {
        &quot;kind&quot;: &quot;exp-lookit-video-assent&quot;,
            &quot;pages&quot;: [
                {
                    &quot;imgSrc&quot;: &quot;jane_smith.png&quot;,
                    &quot;altText&quot;: &quot;Jane Smith&quot;,
                    &quot;textBlocks&quot;: [
                        {
                            &quot;text&quot;: &quot;My name is Jane Smith. I am a scientist who studies why children love cats.&quot;
                        }
                    ]
                },
                {
                    &quot;imgSrc&quot;: &quot;cats_game.png&quot;,
                    &quot;altText&quot;: &quot;picture of sample game&quot;,
                    &quot;textBlocks&quot;: [
                        {
                            &quot;text&quot;: &quot;In this study, you will play a game about cats.&quot;
                        }
                    ]
                },
                {
                    &quot;showWebcam&quot;: true,
                    &quot;textBlocks&quot;: [
                        {
                            &quot;text&quot;: &quot;During the study, your webcam will record a video of you. We will watch this video later to see how much you love cats.&quot;
                        }
                    ]
                }
            ],
            &quot;baseDir&quot;: &quot;https://s3.amazonaws.com/lookitcontents/cats/&quot;,
            &quot;videoTypes&quot;: [
                &quot;webm&quot;,
                &quot;mp4&quot;
            ],
            &quot;participationQuestion&quot;: &quot;Do you want to participate in this study?&quot;
        }
    }
}
&#x60;&#x60;&#x60;

@class ExpLookitVideoAssent
@extends ExpFrameBase

@uses VideoRecord
*/

export default ExpFrameBaseComponent.extend(VideoRecord, MediaReload, ExpandAssets, {
    layout,
    frameType: &#x27;CONSENT&#x27;,
    disableRecord: Em.computed(&#x27;recorder.recording&#x27;, &#x27;recorder.hasCamAccess&#x27;, function () {
        return !this.get(&#x27;recorder.hasCamAccess&#x27;) || this.get(&#x27;recorder.recording&#x27;);
    }),
    startedRecording: false,

    pageIndex: 0,
    readAllPages: false,

    noNext: computed(&#x27;pageIndex&#x27;, function() {
        return this.get(&#x27;pageIndex&#x27;) &gt;= this.get(&#x27;pages.length&#x27;) - 1;
    }),

    noPrev: computed(&#x27;pageIndex&#x27;, function() {
        return this.get(&#x27;pageIndex&#x27;) &lt;= 0;
    }),

    currentPage: computed(&#x27;pageIndex&#x27;, function() {
        return this.get(&#x27;pages_parsed&#x27;)[this.get(&#x27;pageIndex&#x27;)];
    }),

    childResponse: false,
    stoppedRecording: false,

    assetsToExpand: {
        &#x27;audio&#x27;: [],
        &#x27;video&#x27;: [&#x27;pages/sources&#x27;],
        &#x27;image&#x27;: [&#x27;pages/imgSrc&#x27;]
    },



    actions: {

        nextVideo() {
            this.set(&#x27;pageIndex&#x27;, this.get(&#x27;pageIndex&#x27;) + 1);
            if ( this.get(&#x27;pageIndex&#x27;) == this.get(&#x27;pages&#x27;).length - 1) {
                this.set(&#x27;readAllPages&#x27;, true);
            }
        },
        previousVideo() {
            this.set(&#x27;pageIndex&#x27;, this.get(&#x27;pageIndex&#x27;) - 1);
        },

        selectYes() {
            this.set(&#x27;childResponse&#x27;, &#x27;Yes&#x27;);
        },

        selectNo() {
            this.set(&#x27;childResponse&#x27;, &#x27;No&#x27;);
        },

        record() {
            this.startRecorder().then(() =&gt; {
                this.set(&#x27;startedRecording&#x27;, true);
                // Require at least 3 s recording
                setTimeout(function() {
                    $(&#x27;#submitbutton&#x27;).prop(&#x27;disabled&#x27;, false);
                }, 3000);
            });
        },
        submit() {
            this.session.set(&#x27;completedConsentFrame&#x27;, true);
            if (this.get(&#x27;childResponse&#x27;) == &#x27;Yes&#x27;) {
                this.send(&#x27;next&#x27;);
            } else {
                this.send(&#x27;exit&#x27;);
            }
        },
        download() {
            // Get the text of the consent form to process. Split into lines, and remove
            // repeat empty lines. Start each new line with an indent.

            console.log(this);

            var origText = $(&#x27;#consent-form-full-text&#x27;).text().split(/\r?\n/);
            var trimmedText = [];
            var emptyLineWasLast = false;
            $.each(origText, function(idx, val) {
                if (val.trim() || !emptyLineWasLast) {
                    trimmedText.push(&#x27;     &#x27; + val.trim());
                    if (emptyLineWasLast) {
                        trimmedText.push(&#x27;&#x27;);
                    }
                }
                if (val.trim()) {
                    emptyLineWasLast = false;
                } else {
                    emptyLineWasLast = true;
                }
            });

            // Prep PDF - need to set font before splitting lines
            // jscs:disable requireCapitalizedConstructors
            var consentPDF = new jsPDF();
            // jscs:enable requireCapitalizedConstructors
            consentPDF.setFont(&#x27;times&#x27;);
            consentPDF.setFontSize(12);
            var timeString = moment().format(&#x27;MMMM Do YYYY, h:mm:ss a&#x27;); // for header

            // Wrap lines so they&#x27;ll fit nicely on the page
            var splitText = consentPDF.splitTextToSize(trimmedText, 150);

            // Split into pages
            var linesPerPage = 55;
            var nPages = Math.ceil(splitText.length / linesPerPage);
            for (var iPage = 0; iPage &lt; nPages; iPage++) {
                // Header on each page
                consentPDF.setFontSize(10);
                consentPDF.text(&#x27;Child assent form: &#x27; + this.get(&#x27;experiment&#x27;).get(&#x27;name&#x27;), 10, 10)
                consentPDF.text(timeString + &#x27; (page &#x27; + (iPage + 1) + &#x27; of &#x27; + nPages + &#x27;)&#x27;, 10, 15);
                // Actual text for the page
                consentPDF.setFontSize(12);
                consentPDF.text(splitText.slice(linesPerPage * iPage, linesPerPage * (iPage + 1)), 25, 25);

                // Go to the next page
                if (iPage &lt; (nPages - 1)) {
                    consentPDF.addPage();
                }
            }
            consentPDF.save(&#x27;Lookit_study_child_assent_&#x27; + moment().format(&#x27;YYYY_MM_DD&#x27;) + &#x27;.pdf&#x27;);

            /**
             * When participant downloads consent form
             *
             * @event downloadConsentForm
             */
            this.send(&#x27;setTimeEvent&#x27;, &#x27;downloadConsentForm&#x27;);
        }
    },

    meta: {
        name: &#x27;Video assent form&#x27;,
        description: &#x27;A video assent form.&#x27;,
        parameters: {
            type: &#x27;object&#x27;,
            properties: {
                /**
                 * A list of pages of assent form text/pictures/video for the participant to read through
                 *
                 * @property {Array} pages
                 *   @param {String} altText Alt-text used for the image displayed, if any
                 *   @param {Object[]} sources (Optional) String indicating video path relative to baseDir (see baseDir), OR Array of {src: &#x27;url&#x27;, type: &#x27;MIMEtype&#x27;} objects.
                 *   @param {String} imgSrc (Optional) URL of image to display; can be full path or relative to baseDir
                 *   @param {Object[]} textBlocks list of text blocks to show on this page, processed by exp-text-block. Can use HTML.
                 *   @param {Boolean} showWebcam Whether to display the participant webcam on this page
                 */
                pages: {
                    type: &#x27;array&#x27;,
                    description: &#x27;A list of videos to preview&#x27;,
                    items: {
                        type: &#x27;object&#x27;,
                        properties: {
                            imgSrc: {
                                type: &#x27;string&#x27;,
                                default: &#x27;&#x27;
                            },
                            altText: {
                                type: &#x27;string&#x27;,
                                default: &#x27;image&#x27;
                            },
                            sources: {
                                type: &#x27;array&#x27;,
                                default: [],
                                items: {
                                    type: &#x27;object&#x27;,
                                    properties: {
                                        src: {
                                            type: &#x27;string&#x27;
                                        },
                                        type: {
                                            type: &#x27;string&#x27;
                                        }
                                    },
                                    required: [&#x27;src&#x27;, &#x27;type&#x27;]
                                }
                            },
                            textBlocks: {
                                type: &#x27;array&#x27;,
                                default: []
                            },
                            showWebcam: {
                                type: &#x27;Boolean&#x27;,
                                default: false
                            }
                        },
                        required: []
                    },
                    default: []
                },
                /**
                 * Text on the button to proceed to the next example video/image
                 *
                 * @property {String} nextStimulusText
                 */
                nextStimulusText: {
                    type: &#x27;string&#x27;,
                    description: &#x27;Text on the button to proceed to the next example video/image&#x27;,
                    default: &#x27;Next&#x27;
                },
                /**
                 * Text on the button to proceed to the previous example video/image
                 *
                 * @property {String} previousStimulusText
                 */
                previousStimulusText: {
                    type: &#x27;string&#x27;,
                    description: &#x27;Text on the button to proceed to the previous example video/image&#x27;,
                    default: &#x27;Previous&#x27;
                },
                /**
                 * Text of the question to ask about whether to participate. Answer options are Yes/No; No means study will stop, Yes means it will proceed.
                 *
                 * @property {String} participationQuestion
                 */
                participationQuestion: {
                    type: &#x27;string&#x27;,
                    description: &#x27;Text on the button to proceed to the previous example video/image&#x27;,
                    default: &#x27;Do you want to participate in this study?&#x27;
                }
            },
            required: []
        },
        data: {
            /**
             * Parameters captured and sent to the server
             *
             * @method serializeContent
             * @param {String} assentFormText the exact text shown in the assent document during this frame
             * @param {String} videoID The ID of any webcam video recorded during this frame
             * @param {List} videoList a list of webcam video IDs in case there are &gt;1
             * @param {String} childResponse The child&#x27;s response to the assent question - Yes or No
             * @param {Object} eventTimings
             * @return {Object} The payload sent to the server
             */
            type: &#x27;object&#x27;,
            properties: {
                videoId: {
                    type: &#x27;string&#x27;
                },
                videoList: {
                    type: &#x27;list&#x27;
                },
                assentFormText: {
                    type: &#x27;string&#x27;
                },
                childResponse: {
                    type: &#x27;string&#x27;
                }
            },
            required: []
        }
    },


    didInsertElement() {
        this._super(...arguments);
        this.set(&#x27;assentFormText&#x27;, $(&#x27;#consent-form-full-text&#x27;).text());
    }
});

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
